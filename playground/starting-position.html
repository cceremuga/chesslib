<!doctype html>
<html>
<title>Chess view</title>
<head>
<style>

.fenCode {
  font-size:12px;
  width: 420px;
}

</style>
</head>
<body>
<link rel="stylesheet" href="../theme/base/style.css">
<div id="chessview"></div>
<h3>FEN:</h3>
<div id="fenCode"></div>
<script src="../node_modules/traceur/bin/traceur-runtime.js"></script>
<script src="../browser/bundle.js"></script>
<script>
(function () {
  var mercury = require('mercury');
  var FEN = require('chessview').FEN;
  var playable = require('chessview').ui.playable;
  var innovation = require('chessview').innovation;

  var state = playable(fromQuery());

  mercury.app(
    document.getElementById('chessview'),
    state,
    playable.board
  );

  var h = mercury.h;

  var rotated = mercury.input();
  rotated(function (value) {
    state.rotated.set(value.rotated);
  });

  // example of hacking together an ad-hoc component
  mercury.app(
    document.getElementById('fenCode'),
    state,
    function (state) {
      return h('div', [
        h('div', h('input.fenCode', {
          'type': 'text',
          'readonly': true,
          'value': FEN.stringify(state.position)
        })),
        h('div', h('label', {
          'for': 'rotated',
        }, [
          h('input', {
            'type': 'checkbox',
            'name': 'rotated',
            'id': 'rotated',
            'checked': state.rotated,
            'ev-change': mercury.valueEvent(rotated),
          }),
          "Rotate board"
        ]))
      ]);
    }
  );

  function fromQuery() {
      var search = location.search;
      if (!search) {
        return FEN.parse(FEN.standard);
      }
      var plainSearch = decodeURIComponent(location.search.replace('?', ''));
      switch (plainSearch.toLowerCase()) {
      case '960':
      case 'ninesixty':
      case 'fischerandom':
        return innovation.fischerandom();
      case 'doublefischerandom':
        return innovation.doubleFischerandom();
      default:
        return FEN.parse(plainSearch);
      }
  }
}());
</script>
